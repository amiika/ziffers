load "~/ziffers/ziffers.rb"

# Musical dice game: https://opus-infinity.org/dice_games/mozart_waltz/
# Still work in progress

use_bpm 18
use_synth :piano
use_random_seed 52335

tremble = [ "e ^ 3 1 4 ", "e , 5 s #3 4 6 ^ 4 ", "e ^ 4 0 2 ", "e ^ 4 q 1 ", "q ,46^14 e r ", "e , 4 ^ 0 2 ", "s ^ 2 0 2 4 ^^ 0 ^ 4 ", "q ^ 0 e r ", "e ^02 ,6^1 r ", "s , 6 5 6 ^ 0 1 , 6 ", "s ^ 2 0 , 6 5 4 #3 ", "e 2^0 ,2^0 ,2^0 ", "e ^ 0 , 4 2 ", "q ^ 0 e r ", "e ^ 2 s 4 2 e 0 ", "e ^ 5 #3 1 ", "s ^ 0 , 4 ^ 0 2 , 4 ^ 0 ", "e , 4 ^ 0 2 ", "s ^ 2 0 e 2 4 ", "e ^ 4 s 6 ^^ 1 e ^ 1 ", "s ^ 0 2 4 1 , 5 ^ #3 ", "e ^ 2 0 , 4 ", "s ^ 3 2 1 2 3 4 ", "q ,46^14 e r ", "s , 1 #3 5 ^ 1 #3 5 ", "e ^02 02 02 ", "s ^ 3 2 3 1 0 , 6 ", "s ^ #3 1 , 5 ^ 5 #3 1 ", "s , 6 ^ 1 4 1 e , 6 ", "q 46^14 e r ", "s ^ 2 0 e , 4 ^ 2 ", "e , 4 ^ 0 3 ", "q ,46^14 e r ", "s ^ 2 0 1 , 6 e 4 ", "e 5 ^ 1 #3 ", "s , 5 ^ 2 1 4 #3 5 ", "s ^ 4 6 4 1 e , 6 ", "e ^ 0 , 4 ^ 2 ", "e ^ 4 , 4 4 ", "s ^ 0 , 6 ^ 0 2 , 4 ^ 0 ", "s ^ 0 , 6 ^ 0 2 e , 4 ", "s 6 ^ 0 1 , 6 5 4 ", "e ^ 4 s 3 2 1 0 ", "e , 5 s ^ 3 1 , 5 6 ", "s ^ 0 , 6 ^ 0 , 4 2 0 ", "e ^ 4 s 6 4 1 , 6 ", "e ^ 4 s 4 1 e 6 ", "e ^ 2 s 0 2 4 ^^ 0 ", "e ^ 2 , 6 4 ", "e ^ 0 s 2 0 e , 4 ", "s ^ 0 , 4 ^ 2 0 4 2 ", "s ^ 1 #0 1 3 , 4 6 ", "e ^02 s 02 13 e 24 ", "e ,2^0 ,2^0 ,2^0 ", "e ^ 4 6 1 ", "s ^ 1 , 6 e 4 r ", "e ^ 2 0 , 4 ", "e ^ 4 2 0 ", "e ^ 4 0 2 ", "e ^ 4 s 3 2 1 0 ", "e ^ 0 s 2 0 e 4 ", "s ^ 2 0 , 6 4 5 #3 ", "s ^ 2 0 , 6 ^ 0 e , 4 ", "s ^ 2 4 ^^ 0 ^ 4 2 0 ", "s ^ 1 , 5 e ^ 1 #3 ", "e ^ 3 5 3 ", "s ^ 0 , 6 ^ 0 2 , 4 ^ 0 ", "e ^ 4 s 6 5 1 4 ", "e ^ 4 3 0 ", "e ^ #3 s 5 #3 1 #3 ", "s ^ 4 6 ^^ 1 ^ 6 e 4 ", "s ^ 3 2 1 0 , 6 ^ 1 ", "e ^ 4 2 0 ", "s ^^ 0 ^ 6 ^^ 0 ^ 4 2 0 ", "e ^1#3 1#3 1#3 ", "s ^^ 0 ^ 6 ^^ 0 ^ 4 2 0 ", "s ^ 4 6 e 4 1 ", "e ^ 0 , 0 r ", "q ^ 0 e r ", "e ^ 1 , 5 ^ #3 ", "q ,46^14 e r ", "s ^ 1 , 6 e 4 ^ 4 ", "q ^ 0 e r ", "s ^ 0 , 4 ^ 2 0 4 2 ", "e ^ 0 2 , 4 ", "e ^ 1 s 1 4 e 6 ", "e ^ 4 0 2 ", "s ^ 4 1 4 6 4 1 ", "s ^ 3 2 e 1 4 ", "s ^ #3 5 ^^ 1 ^ 5 #3 5 ", "q ,46^14 e r ", "e ,6^1 s 4 6 e 1 ", "q ^ 0 e r ", "q ,46^14 e r ", "e ^ 4 2 0 ", "e ^ 2 0 , 4 ", "s ^ 4 #3 4 1 , 6 4 ", "e ^ 0 , 4 ^ 2 ", "e ^ #3 5 1 ", "q ,46^14 e r ", "s ^ 2 1 2 4 ^^ 0 ^ 4 ", "s ^ #3 1 e , 5 ^ #3 ", "s ^ 0 2 0 , 4 e 2 ", "s ^ 2 1 2 4 ^^ 0 ^ 4 ", "e ^ #3 s 5 #3 1 #3 ", "e , 5 s ^ 1 0 , 6 5 ", "q 46^14 e r ", "e ^ 2 4 ^^ 0 ", "s ^ 1 3 1 3 , 6 ^ 1 ", "s ,6^1 ,5^0 ,5^0 ,46 46 #35 ", "q ^ 0 e r ", "e ^ 2 0 , 4 ", "e ^ 3 1 , 6 ", "e 6^1 ,6^1 ,6^1 ", "s , 5 4 ^ 2 0 4 2 ", "s ^ 1 3 5 3 1 , 6 ", "s ^ 1 , 5 ^ 1 #3 5 #3 ", "s ^ 2 5 4 6 #3 5 ", "s ^ 2 0 4 2 ^^ 0 ^ 4 ", "e ^^ 1 s ^ 5 #3 1 , 5 ", "e ^ 4 s 6 4 e 1 ", "s ^ 4 #3 4 6 e 1 ", "q ,46^14 e r ", "e ,2^0 ,2^0 ,2^0 ", "s ^ 4 2 1 , 6 e 4 ", "s ^ 0 , 4 ^ 0 2 4 02 ", "q ,46^14 e r ", "e , 6 ^ 1 4 ", "s ^ 5 4 #3 4 e 1 ", "e ,2^0 ,2^0 ,2^0 ", "q ^ 0 e r ", "e ^02 s ,6^1 ,46 e 4 ", "e ^ 1 s 4 1 , 6 ^ 1 ", "s , 5 ^ 2 ,6^1 ,5^0 ,46 #35 ", "e ^ #3 s #3 1 e 5 ", "s ^^ 0 ^ 6 ^^ 0 ^ 4 2 0 ", "e ^ 0 , 4 ^ 2 ", "e ,5^1#3 q 4 ", "s ^ 4 6 4 6 e 1 ", "e ^ 0 s 0 1 e #3 ", "s ^ 1 2 3 1 0 0 ", "e ^ 0 , 4 ^ 2 ", "e ^ 4 s 1 , 6 e 4 ", "e ^ 4 0 2 ", "s ^ 1 3 , 5 ^ 1 , 6 ^ 1 ", "e ,#3^1 1#3 #35 ", "s ^ 2 ^^ 0 ^ 6 4 5 #3 ", "s ^^ 0 ^ 6 ^^ 0 ^ 4 2 0 ", "s ^ 3 1 e , 5 6 ", "e 4^02 q 2 ", "q ^ 0 e r ", "e ^ 4 s 3 2 1 0 ", "s ^ 1 , 5 ^ #3 1 5 #3 ", "s ^ 1 #0 1 #3 5 #3 ", "s ^ 4 6 4 1 , 6 4 ", "s ^ 0 , 4 ^ 2 0 e 4 ", "s ^ 2 1 2 4 ^^ 0 ^ 4 ", "e , 6 s ^ 1 , 6 5 4 ", "s ^ 2 4 1 0 , 6 5 ", "s ^ 0 , 6 ^ 0 2 , 4 ^ 0 ", "e ,#3^1 ,#3^1 ,#3^1 ", "s ^ 2 1 2 4 ^^ 0 ^ 4 ", "s ^ 4 #3 4 1 , 6 4 ", "e ^ 1 q , 4 ", "e ^ 1 , 6 4 ", "s ^ 0 6 4 1 e , 6 ", "e ^ 0 s 0 1 e 2 ", "e ^ 4 s 3 2 1 0 "]

bass = ["e _ 3 1 4 ", "q __6_4 e r ", "q _02 e r ", "s __ 4 6 e _ 4 __ 6 ", "e __ 4 s _46 34 2#3 12 ", "q _02 e r ", "q _04 e r ", "e _ 0 __ 4 0 ", "q _ 4 e __ 4 ", "q _ 4 e r ", "e _ 0 1 __ 1 ", "e _ 0 0 0 ", "q _24 e r ", "e _ 0 __ 4 0 ", "q _04 e 02 ", "q _1#3 e 0#3 ", "q _24 e r ", "q _02 e 04 ", "q _04 e 02 ", "q _ 1 e r ", "e _ 0 1 __ 1 ", "q _ 0 e r ", "s _ 3 2 1 2 3 4 ", "e __ 4 s _46 34 2#3 12 ", "q _ 1 e 0 ", "s _ 0 2 4 2 , 0 _ 0 ", "q _46 e r ", "q _05 e r ", "q _ 4 e __ 4 ", "e __ 4 s _46 34 2#3 12 ", "q _04 e 04 ", "q _02 e r ", "e __ 4 s _46 34 2#3 12 ", "q _ 4 e r ", "q _1#3 e 05 ", "e _ 0 1 __ 1 ", "q __6_1 e r ", "s _02 4 02 4 02 4 ", "s __ 6 _ 1 4 1 __ 6 4 ", "q _02 e r ", "q _02 e r ", "q __ 4 e r ", "q _02 e r ", "q _ 3 e 4 ", "q _24 e r ", "q __6_1 e r ", "q __6_1 e r ", "q _04 e 02 ", "s _02 4 02 5 02 4 ", "q _24 e r ", "q _02 e r ", "q _ 3 e 4 ", "q _ 0 e r ", "e _ 0 0 0 ", "q __6_1 e r ", "q __4_4 e 4 ", "s _02 4 02 4 02 4 ", "s _02 4 02 4 02 4 ", "s _02 4 02 5 02 4 ", "q _02 e r ", "q _24 e r ", "e _ 0 1 __ 1 ", "q _ 0 e r ", "q _04 e 04 ", "q _1#3 e r ", "e _15 1#3 01 ", "q __6_2 e 24 ", "q __ 6 e r ", "q _02 e r ", "q _ 1 e 0 ", "q __6_1 e __6_1 ", "q _ 3 e 4 ", "s _02 4 02 4 02 4 ", "q _02 e r ", "e _ 0 0 0 ", "q _02 e 04 ", "q __6_1 e __6_4 ", "q _ 0 e __ 0 ", "e _ 0 __ 4 0 ", "q _ 0 e r ", "e __ 4 s _46 34 2#3 12 ", "q __6_4 e __6_1 ", "e _ 0 __ 4 0 ", "q _02 e r ", "q _24 e r ", "q __6_4 e r ", "q _02 e 04 ", "q __6_1 e __6_1 ", "s _ 3 2 e 1 4 ", "q _05 e 05 ", "e __ 4 s _46 34 2#3 12 ", "q __4_4 e 4 ", "e _ 0 __ 4 0 ", "e __ 4 s _46 34 2#3 12 ", "q _02 e r ", "q _ 0 e r ", "q __6_1 e __6_4 ", "s _02 4 02 4 02 4 ", "q _05 e 05 ", "e __ 4 s _46 34 2#3 12 ", "q _04 e 02 ", "q _05 e 05 ", "q _24 e r ", "q _ 0 e r ", "q _ 0 e r ", "e _ 0 1 __ 1 ", "e __ 4 s _46 34 2#3 12 ", "q _04 e 02 ", "q _35 e 4,1 ", "e _ 0 1 __ 1 ", "e _ 0 __ 4 0 ", "s _02 4 02 4 02 4 ", "q _46 e r ", "e _ 4 4 4 ", "q _02 e r ", "q _ 3 e 4 ", "q _1#3 e r ", "e _ 0 1 __ 1 ", "q _02 e r ", "q _1#3 e 0#3 ", "q __6_4 e r ", "e __6_1 __6_1 __6_4 ", "e __ 4 s _46 34 2#3 12 ", "e _ 0 0 0 ", "e _ 4 __ 4 r ", "q _ 2 s 2 0 ", "e __ 4 s _46 34 2#3 12 ", "q __ 4 e r ", "e __6_1 __6_1 __6_4 ", "e _ 0 0 0 ", "e _ 0 __ 4 0 ", "e _ 4 __ 4 r ", "q __6_4 e r ", "e _ 0 1 __ 1 ", "e _01 01 01 ", "q _02 e r ", "s _02 4 02 4 02 4 ", "s __ 1 _ 1 #0 1 0 1 ", "q __ 6 e r ", "e _0#3 0#3 05 ", "q __6_4 e __ 4 ", "q _02 e r ", "q __6_1 e __6_1 ", "s _02 4 02 4 02 4 ", "q _ 3 e 4 ", "e _ 0 0 0 ", "e _ 0 1 __ 1 ", "q _02 e r ", "q _ 3 e 4 ", "s _ 0 __ 6 _ 0 1 2 #3 ", "e _ 0 __ 4 0 ", "q _02 e r ", "q _ 0 e r ", "q _ 0 e r ", "q __6_1 e r ", "q _24 e r ", "q _ 0 e r ", "q __ 4 e r ", "e _ 0 1 __ 1 ", "q _02 e 02 ", "e _ 0 0 0 ", "q _04 e 02 ", "q __6_1 e r ", "s _ 4 #3 4 1 __ 6 4 ", "q __ 6 e r ", "q _46 e r ", "q _02 e r ", "q _02 e 24 "]

dice_table = [[96,22,141,41,105,122,11,30,70,121,26,9,112,49,109,14],
              [32,6,128,63,146,46,134,81,117,39,126,56,174,18,116,83],
              [69,95,158,13,153,55,110,24,66,139,15,132,73,58,145,79],
              [40,17,113,85,161,2,159,100,90,176,7,34,67,160,52,170],
              [148,74,163,45,80,97,36,107,25,143,64,125,76,136,1,93],
              [104,157,27,167,154,68,118,91,138,71,150,29,101,162,23,151],
              [152,60,171,53,99,133,21,127,16,155,57,175,43,168,89,172],
              [119,84,114,50,140,86,169,94,120,88,48,166,51,115,72,111],
              [98,142,42,156,75,129,62,123,65,77,19,82,137,38,149,8],
              [3,87,165,61,135,47,147,33,102,4,31,164,144,59,173,78],
              [54,130,10,103,28,37,106,5,35,20,108,92,12,124,44,131]]


indices = 8.times.collect {|i| dice_table[(dice 11)-1][i] }
random_ending_1 = dice_table[7][(dice 10)-1]
random_ending_2 = dice_table[7][(dice 10)-1]
t1 = indices.map{|v| tremble[v]}
t1 = t1 << tremble[random_ending_1] << t1.clone << tremble[random_ending_2]
b1 = indices.map{|v| bass[v]}
b1 = b1 << bass[random_ending_1] << b1.clone << bass[random_ending_2]

indices = 8.upto(15).collect {|i| dice_table[(dice 11)-1][i] }
t2 = indices.map{|v| tremble[v]}
b2 = indices.map{|v| bass[v]}

staff_1 = (t1+t2).join(" ")
staff_2 = (b1+b2).join(" ")

in_thread do
  zplay staff_2
end

zplay staff_1
